{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.js","sourcesContent":["'use strict';\n\n\n// CONTROLES --------------------------------------------------\n\n//fijos\nconst searchForm = document.getElementById('searchForm');\nconst searchInput = document.getElementById('searchInput');\nconst searchButton = document.getElementById('searchButton');\n\n//dinámicos\n//************************************************ <--------  OJO incluir showCard y x en favCard\n\nconst clearFavPannel = document.createElement('button');\nconst clearFavPannelContent = document.createTextNode('vaciar favoritos');\nclearFavPannel.appendChild(clearFavPannelContent);\nclearFavPannel.addEventListener('click', function(){emptyFavPannel()});\n/*el botón se añadirá: a. si al cargar la página existen favoritos b. si no hay favoritos y añadimos uno\nel botón se borrará si  a. eliminamos el último favorito b. hacemos click en él*/\n\n\n// DATOS DE PARTIDA ---------------------------------------------\nconst urlShowSearchByName = 'http://api.tvmaze.com/search/shows?';\nconst urlShowSearchById = 'http://api.tvmaze.com/shows/';\n\n// RESULTADOS\nconst searchResultsIntro = document.getElementById('searchResultsIntro');\nconst searchResultsList = document.getElementById('searchResultsList');\nconst favListIntro = null;  //************************************************ <--------  OJO por definir\nconst favList = document.getElementById('favList');\n\nlet searchResultShows = null; // recibe resultados del servidor\nlet favShows = []; // recibe elementos añadidos con push\n\n\n// Al cargar la página --------------------------------------------\n\nconst savedFavs = JSON.parse(localStorage.getItem('favShows'));\nif (savedFavs !== null && savedFavs.length !== 0) {\n  favList.appendChild(clearFavPannel);\n  savedFavs.map(fav => addOrRemoveFavourite(fav));\n}\n\n\n// ACCIONES ****************************************************************************************\n\n//Gestión de FAVORITOS ------------------------------------\n\nfunction emptyFavPannel () {\nfavShows.map(fav => changeCardStyle(fav)); // cambio de estilo\nconst FavsToRemove = favShows.map(fav => fav); //copiamos los favoritos\nFavsToRemove.reverse(); // damos la vuelta a la copia de favoritos para recorrerlos desde último a primero\nFavsToRemove.map(fav => addOrRemoveFavourite(fav));\n};\n\nfunction renderFav(newFav) {\n  //LI\n  const favCard = document.createElement('li');\n  favCard.id = newFav.id + 'FAV';\n  favCard.classList.add('aside__favList--card')\n  favList.appendChild(favCard);\n  //TITLE\n  const favTitle = document.createElement('p');\n  favTitle.classList.add('aside__favList--title')\n  favCard.appendChild(favTitle);\n  const favTitleContent = document.createTextNode(newFav.name);\n  favTitle.appendChild(favTitleContent);\n  //IMAGE\n  const favImage = document.createElement('img');\n  const imageSource = newFav.image !== null ? newFav.image.medium : 'https://via.placeholder.com/210x295?text=TV';\n  favImage.classList.add('aside__favList--image')\n  favImage.src = imageSource;\n  favCard.appendChild(favImage);\n  //DELETE BUTTON\n  const favDeleteButton = document.createElement('div');\n  favCard.appendChild(favDeleteButton);\n  const favDeleteButtonContent = document.createTextNode('X');\n  favDeleteButton.appendChild(favDeleteButtonContent);\n  //make X icons react to click\n  favDeleteButton.addEventListener('click', function(){\n    addOrRemoveFavourite(newFav.id.toString());\n    changeCardStyle(newFav.id.toString())\n  });\n};\n\nfunction getFavInfo(id) {\n  fetch(urlShowSearchById + id)\n    .then(function (response) {\n      if (!response.ok) { throw response; }\n      return response.json();\n    })\n    .then(function (data) {\n      let newFav = data;\n      renderFav(newFav)\n    })\n    .catch(error => console.log(`Ha sucedido un error: ${error}`));\n\n};\n\nfunction addOrRemoveFavourite(id) { //Añadimos cada nuevo favorito tanto al listado como a localStorage\n  if (parseInt(favShows.indexOf(id)) === (-1)) {\n    favShows.push(id);\n    getFavInfo(id);\n    if (favList.innerHTML.length ===0) {\n      favList.appendChild(clearFavPannel);\n    }\n  } else {\n    favShows.splice(parseInt(favShows.indexOf(id)), 1);\n    document.getElementById(id + 'FAV').remove();\n    if (favShows.length<1){\n      favList.removeChild(clearFavPannel);\n    }\n  }\n  localStorage.setItem('favShows', JSON.stringify(favShows));\n};\n\nfunction changeCardStyle(id) {\n  if(document.getElementById(id) !== null){\n    document.getElementById(id).classList.toggle('main__favShowStyle');\n  }\n}\n\n//Gestión de resultados de BÚSQUEDA ------------------------------------\n\nfunction renderSearchResultShows(show) {\n  //LI\n  const resultCard = document.createElement('li');\n  resultCard.id = show.show.id;\n  if (parseInt(favShows.indexOf(resultCard.id)) !== (-1)) {\n    resultCard.classList.add('main__favShowStyle')\n  }\n  resultCard.classList.add('main__resultsList--card')\n  searchResultsList.appendChild(resultCard);\n  //TITLE\n  const resultCardTitle = document.createElement('p');\n  resultCard.appendChild(resultCardTitle);\n  const resultCardTitleContent = document.createTextNode(show.show.name);\n  resultCardTitle.appendChild(resultCardTitleContent);\n  //IMAGE\n  const resultCardImage = document.createElement('img');\n  const imageSource = show.show.image !== null ? show.show.image.medium : 'https://via.placeholder.com/210x295?text=TV';\n  resultCardImage.src = imageSource;\n  resultCard.appendChild(resultCardImage);\n  // make card react on clicks\n  resultCard.addEventListener('click', function () { \n    addOrRemoveFavourite(resultCard.id); \n    changeCardStyle(resultCard.id)\n  });\n}\n\nfunction countResults(count, text) {\n  searchResultsIntro.innerHTML = '';\n  const searchResultsIntroContent = document.createTextNode(\n    `Tenemos ${count} resultados para tu búsqueda \"${text}\", ordenados por popularidad.`\n  );\n  searchResultsIntro.appendChild(searchResultsIntroContent);\n}\n\nfunction showSearchByName() {\n  let query = searchInput.value;\n  fetch(`${urlShowSearchByName}q=${query}`)\n    .then(function (response) {\n      if (!response.ok) { throw response; }\n      return response.json();\n    })\n    .then(function (data) {\n      searchResultShows = data;  //******************************** <---- para ver más páginas: acumulador\n      countResults(searchResultShows.length, query);  // Ejecutamos el contador 1 vez\n      for (let show of searchResultShows) {\n        renderSearchResultShows(show);                // Ejecutamos el renderizador en bucle, por resultado\n      }\n    })\n    .catch(error => console.log(`Ha sucedido un error: ${error}`));\n};\n\nfunction handleSearchButton(event) {\n  event.preventDefault();\n  searchResultsList.innerHTML = '';\n  showSearchByName();\n  searchForm.reset();\n}\n\nsearchButton.addEventListener('click', handleSearchButton);\n\n"]}