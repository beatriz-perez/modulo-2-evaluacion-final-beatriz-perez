"use strict";const searchForm=document.getElementById("searchForm"),searchInput=document.getElementById("searchInput"),searchButton=document.getElementById("searchButton"),clearFavPannel=document.createElement("button");clearFavPannel.classList.add("aside__favList--clearButton","button__lightLong","text__lightButton");const clearFavPannelContent=document.createTextNode("vaciar favoritos");clearFavPannel.appendChild(clearFavPannelContent),clearFavPannel.addEventListener("click",(function(){emptyFavPannel()}));const urlShowSearchByName="http://api.tvmaze.com/search/shows?",urlShowSearchById="http://api.tvmaze.com/shows/",mainSection=document.querySelector(".mainSection"),searchResultsIntro=document.getElementById("searchResultsIntro"),searchResultsInstructions=document.getElementById("searchResultsInstructions"),alertText=document.getElementById("alerText"),searchResultsList=document.getElementById("searchResultsList");let searchResultShows=null;const favList=document.getElementById("favList");let favShows=[];const showInfoBox=document.getElementById("showInfo"),savedFavs=JSON.parse(localStorage.getItem("favShows"));function emptyFavPannel(){favShows.map(e=>changeCardStyle(e));const e=favShows.map(e=>e);e.reverse(),e.map(e=>addOrRemoveFavourite(e))}function getFavInfo(e){fetch(urlShowSearchById+e).then((function(e){if(!e.ok)throw e;return e.json()})).then((function(e){renderFav(e)})).catch(e=>console.log(`Ha sucedido un error: ${e}`))}function addOrRemoveFavourite(e){if(alertText.innerHTML="",-1===parseInt(favShows.indexOf(e)))if(favShows.length>=10){window.location="#",mainSection.scroll(0,0);const t=document.createTextNode("* Tu listado de favoritos está completo. Por favor, elimina alguno antes de añadir uno nuevo.");alertText.appendChild(t),changeCardStyle(e)}else favShows.push(e),getFavInfo(e),0===favList.innerHTML.length&&favList.appendChild(clearFavPannel);else favShows.splice(parseInt(favShows.indexOf(e)),1),document.getElementById(e+"FAV").remove(),favShows.length<1&&favList.removeChild(clearFavPannel);localStorage.setItem("favShows",JSON.stringify(favShows))}function changeCardStyle(e){null!==document.getElementById(e)&&(document.getElementById(e).classList.toggle("main__favShowStyle"),document.getElementById(e).children[0].classList.toggle("text__card--titleFav"))}function countResults(e,t){searchResultsIntro.innerHTML="",searchResultsInstructions.innerHTML="";const n=document.createTextNode(`Tenemos ${e} resultados para tu búsqueda "${t}", ordenados por popularidad.`);searchResultsIntro.appendChild(n);const a=document.createTextNode("Haz click sobre una serie para añadirla a favoritos y ver más información.");searchResultsInstructions.appendChild(a)}function showSearchByName(){let e=searchInput.value;fetch(`${urlShowSearchByName}q=${e}`).then((function(e){if(!e.ok)throw e;return e.json()})).then((function(t){searchResultShows=t,countResults(searchResultShows.length,e);for(let e of searchResultShows)renderSearchResultShows(e)})).catch(e=>console.log(`Ha sucedido un error: ${e}`))}function handleSearchButton(e){e.preventDefault(),searchResultsList.innerHTML="",alertText.innerHTML="",showInfoBox.innerHTML="",0!==searchInput.value.length&&showSearchByName(),searchForm.reset()}function renderSearchResultShows(e){const t=document.createElement("li");t.id=e.show.id,t.classList.add("main__resultsList--card"),-1!==parseInt(favShows.indexOf(t.id))&&t.classList.add("main__favShowStyle"),searchResultsList.appendChild(t);const n=document.createElement("p");n.classList.add("main__resultsList--title","text__card--title"),-1!==parseInt(favShows.indexOf(t.id))&&n.classList.add("text__card--titleFav"),t.appendChild(n);const a=document.createTextNode(e.show.name);n.appendChild(a);const s=document.createElement("img");s.classList.add("main__resultsList--image");const o=null!==e.show.image?e.show.image.medium:"https://via.placeholder.com/210x295?text=TV";s.src=o,t.appendChild(s),t.addEventListener("click",(function(){addOrRemoveFavourite(t.id),changeCardStyle(t.id)}))}function renderFav(e){const t=document.createElement("li");t.id=e.id+"FAV",t.classList.add("aside__favList--card"),favList.appendChild(t);const n=document.createElement("img"),a=null!==e.image?e.image.medium:"https://via.placeholder.com/210x295?text=TV";n.classList.add("aside__favList--image"),n.src=a,t.appendChild(n);const s=document.createElement("div");s.setAttribute("class","aside__favList--infoBox"),t.appendChild(s);const o=document.createElement("div");o.setAttribute("class","aside__favList--infoBoxTexts"),s.appendChild(o);const c=document.createElement("p");c.classList.add("aside__favList--title","text__card--title"),o.appendChild(c);const d=document.createTextNode(e.name);c.appendChild(d);const i=document.createElement("div");i.classList.add("aside__favList--infoLink","button__grayLong","text__greyButton"),o.appendChild(i);const l=document.createTextNode("+ info");i.appendChild(l),i.addEventListener("click",(function(){showInfo(e)}));const r=document.createElement("div");r.classList.add("aside__favList--deleteButton","button__grayRound"),s.appendChild(r);const u=document.createElement("i");u.classList.add("fas","fa-times","button__grayRound--icon"),r.appendChild(u),r.addEventListener("click",(function(){addOrRemoveFavourite(e.id.toString()),changeCardStyle(e.id.toString())}))}function showInfo(e){searchResultsIntro.innerHTML="",searchResultsInstructions.innerHTML="",alertText.innerHTML="",searchResultsList.innerHTML="",showInfoBox.innerHTML="",window.location="#",mainSection.scroll(0,0);const t=document.createElement("div");t.classList.add("mainInfo__showContent"),showInfoBox.appendChild(t);const n=document.createElement("img");n.classList.add("mainInfo__showContent--image");const a=null!==e.image?e.image.original:"https://via.placeholder.com/400x562?text=TV";n.src=a,t.appendChild(n);const s=document.createElement("div");s.classList.add("mainInfo__showContent--text"),t.appendChild(s);const o=document.createElement("p");o.classList.add("mainInfo__showContent--text-title","text__section--title"),s.appendChild(o);const c=document.createTextNode(e.name);o.appendChild(c);const d=document.createElement("p");d.classList.add("mainInfo__showContent--text-rating","text__base"),s.appendChild(d);const i=document.createTextNode(e.rating.average);d.appendChild(i);const l=document.createElement("p");l.classList.add("mainInfo__showContent--text-summary","text__base"),s.appendChild(l),l.innerHTML=e.summary;const r=document.createElement("a");r.classList.add("mainInfo__showContent--text-officialSite","text__base"),s.appendChild(r),r.href=e.officialSite,r.target="_blank";const u=document.createTextNode(e.officialSite);r.appendChild(u)}null!==savedFavs&&0!==savedFavs.length&&(favList.appendChild(clearFavPannel),savedFavs.map(e=>addOrRemoveFavourite(e))),searchButton.addEventListener("click",handleSearchButton);